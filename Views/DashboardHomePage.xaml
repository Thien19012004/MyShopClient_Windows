<Page
    x:Class="MyShopClient.Views.DashboardHomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewmodels="using:MyShopClient.ViewModels"
    xmlns:lvc="using:LiveChartsCore.SkiaSharpView.WinUI"
    d:DataContext="{d:DesignInstance Type=viewmodels:DashboardViewModel}"
    mc:Ignorable="d">

    <Grid Background="#FFF5F5F7" Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

<!-- Header -->
        <Grid Grid.Row="0">
    <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
    <ColumnDefinition Width="Auto" />
 </Grid.ColumnDefinitions>

            <StackPanel>
       <TextBlock Text="{Binding GreetingText}"
          FontSize="22"
       FontWeight="SemiBold" />
   <TextBlock Text="Sales management dashboard"
          Margin="0,4,0,0"
  Opacity="0.6" />
      </StackPanel>

            <StackPanel Grid.Column="1"
 Orientation="Horizontal"
     VerticalAlignment="Center"
        Spacing="12">
      <Ellipse Width="36" Height="36" Fill="#FF5D5FEF" />
         <TextBlock Text="{Binding UserName}"
             VerticalAlignment="Center"
         FontWeight="SemiBold" />
    <Button Content="Refresh"
           Command="{Binding RefreshCommand}"
     Margin="8,0,0,0" />
  </StackPanel>
        </Grid>

        <!-- Error message -->
        <Border Grid.Row="1"
                Margin="0,12,0,0"
                Padding="12"
                Background="#FFF8D7DA"
                BorderBrush="#FFDC3545"
                BorderThickness="1"
                CornerRadius="8"
                Visibility="{Binding ErrorMessage, Converter={StaticResource StringToVisibilityConverter}}">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <FontIcon Glyph="&#xEA39;" Foreground="#FFB02A37" />
                <TextBlock Text="{Binding ErrorMessage}" Foreground="#FFB02A37" TextWrapping="Wrap" />
            </StackPanel>
        </Border>

        <!-- Summary cards -->
        <Grid Grid.Row="2"
     Margin="0,20,0,0"
        HorizontalAlignment="Stretch"
              VerticalAlignment="Top">
            <Grid.ColumnDefinitions>
   <ColumnDefinition Width="*" />
     <ColumnDefinition Width="*" />
   <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Total Products -->
    <Border Grid.Column="0"
     Margin="4"
        Padding="16"
        CornerRadius="12"
         Background="White">
  <StackPanel>
      <TextBlock Text="Total Products"
         Opacity="0.6"
          FontSize="13" />
            <TextBlock Text="{Binding TotalProducts}"
  FontSize="22"
 FontWeight="SemiBold"
Margin="0,4,0,0" />
     </StackPanel>
       </Border>

          <!-- Orders Today -->
         <Border Grid.Column="1"
              Margin="4"
      Padding="16"
        CornerRadius="12"
        Background="White">
            <StackPanel>
         <TextBlock Text="Orders Today"
               Opacity="0.6"
 FontSize="13" />
        <TextBlock Text="{Binding TotalOrdersToday}"
     FontSize="22"
         FontWeight="SemiBold"
           Margin="0,4,0,0" />
     </StackPanel>
       </Border>

         <!-- Revenue Today -->
      <Border Grid.Column="2"
        Margin="4"
           Padding="16"
  CornerRadius="12"
     Background="White">
     <StackPanel>
      <TextBlock Text="Revenue Today"
    Opacity="0.6"
       FontSize="13" />
           <TextBlock Text="{Binding RevenueTodayText}"
     FontSize="22"
        FontWeight="SemiBold"
  Margin="0,4,0,0" />
           </StackPanel>
         </Border>
</Grid>

        <!-- Main content -->
  <ScrollViewer Grid.Row="3" Margin="0,20,0,0" VerticalScrollBarVisibility="Auto">
<Grid>
    <Grid.RowDefinitions>
       <RowDefinition Height="Auto" />
    <RowDefinition Height="Auto" />
  <RowDefinition Height="Auto" />
      </Grid.RowDefinitions>

   <!-- Row 1: Daily Revenue Chart -->
      <Border Grid.Row="0"
      Margin="4"
           Padding="16"
  CornerRadius="12"
         Background="White">
      <StackPanel>
             <TextBlock Text="Daily Revenue (Current Month)"
   FontSize="16"
         FontWeight="SemiBold" />
     <lvc:CartesianChart Height="250"
       Margin="0,12,0,0"
      Series="{Binding DailyRevenueSeries}"
      XAxes="{Binding DailyRevenueXAxes}"
YAxes="{Binding DailyRevenueYAxes}" />
       </StackPanel>
           </Border>

                <!-- Row 2: Low Stock + Top Selling -->
       <Grid Grid.Row="1" Margin="0,12,0,0">
           <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="*" />
     <ColumnDefinition Width="*" />
     </Grid.ColumnDefinitions>

         <!-- Low Stock Products -->
   <Border Grid.Column="0"
                Margin="4"
        Padding="16"
      CornerRadius="12"
         Background="White">
       <StackPanel>
     <TextBlock Text="Low Stock Products (Stock &lt; 5)"
  FontSize="16"
   FontWeight="SemiBold" />
       <ListView ItemsSource="{Binding LowStockProducts}"
     Margin="0,12,0,0"
       SelectionMode="None">
        <ListView.ItemTemplate>
         <DataTemplate>
          <Grid Padding="4">
         <Grid.ColumnDefinitions>
       <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="*" />
   <ColumnDefinition Width="Auto" />
             </Grid.ColumnDefinitions>
       <TextBlock Text="{Binding Sku}"
   FontWeight="SemiBold"
       Margin="0,0,8,0" />
     <TextBlock Text="{Binding Name}"
    Grid.Column="1" />
    <TextBlock Text="{Binding StockQuantity}"
 Grid.Column="2"
     Foreground="#FFE55353"
       FontWeight="SemiBold" />
         </Grid>
   </DataTemplate>
         </ListView.ItemTemplate>
 </ListView>
     </StackPanel>
        </Border>

        <!-- Top Selling Products -->
         <Border Grid.Column="1"
       Margin="4"
    Padding="16"
           CornerRadius="12"
          Background="White">
        <StackPanel>
              <TextBlock Text="Top 5 Selling Products (This Month)"
    FontSize="16"
      FontWeight="SemiBold" />
 <ListView ItemsSource="{Binding TopSellingProducts}"
    Margin="0,12,0,0"
          SelectionMode="None">
  <ListView.ItemTemplate>
<DataTemplate>
             <Grid Padding="4">
       <Grid.ColumnDefinitions>
 <ColumnDefinition Width="Auto" />
              <ColumnDefinition Width="*" />
  <ColumnDefinition Width="Auto" />
          <ColumnDefinition Width="Auto" />
     </Grid.ColumnDefinitions>
        <TextBlock Text="{Binding Sku}"
         FontWeight="SemiBold"
          Margin="0,0,8,0" />
  <TextBlock Text="{Binding Name}"
     Grid.Column="1" />
 <TextBlock Text="{Binding TotalQuantity}"
            Grid.Column="2"
          Margin="8,0"
      Foreground="#FF13B16A" />
          <TextBlock Grid.Column="3">
            <Run Text="$" />
       <Run Text="{Binding TotalRevenue}" />
               </TextBlock>
       </Grid>
       </DataTemplate>
 </ListView.ItemTemplate>
                  </ListView>
        </StackPanel>
        </Border>
     </Grid>

              <!-- Row 3: Recent Orders -->
      <Border Grid.Row="2"
     Margin="4,12,4,4"
         Padding="16"
      CornerRadius="12"
    Background="White">
            <StackPanel>
              <TextBlock Text="Recent Orders"
             FontSize="16"
        FontWeight="SemiBold" />
       <ListView ItemsSource="{Binding RecentOrders}"
          Margin="0,12,0,0"
         SelectionMode="None">
      <ListView.ItemTemplate>
          <DataTemplate>
       <Grid Padding="8,4">
   <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="Auto" />
     <ColumnDefinition Width="*" />
           <ColumnDefinition Width="Auto" />
  <ColumnDefinition Width="Auto" />
         <ColumnDefinition Width="Auto" />
   </Grid.ColumnDefinitions>
  <TextBlock FontWeight="SemiBold">
    <Run Text="#" />
    <Run Text="{Binding OrderId}" />
          </TextBlock>
             <TextBlock Text="{Binding CustomerName}"
           Grid.Column="1"
        Margin="12,0" />
   <TextBlock Text="{Binding Status}"
      Grid.Column="2"
   Foreground="#FF13B16A"
       Margin="0,0,12,0" />
       <TextBlock Grid.Column="3"
      Margin="0,0,12,0">
  <Run Text="$" />
   <Run Text="{Binding TotalPrice}" />
          </TextBlock>
   <TextBlock Text="{Binding CreatedAt}"
               Grid.Column="4"
         Opacity="0.6"
     FontSize="11" />
           </Grid>
      </DataTemplate>
         </ListView.ItemTemplate>
     </ListView>
          </StackPanel>
      </Border>
            </Grid>
        </ScrollViewer>

 <!-- Loading overlay -->
     <Grid Grid.RowSpan="4"
  Background="#80000000"
      Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}">
     <ProgressRing IsActive="True"
    Width="60"
     Height="60" />
        </Grid>
    </Grid>
</Page>
